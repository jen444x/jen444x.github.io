---
import { sanityClient, urlFor } from "../sanity/client";

// Fetch category covers from Sanity (get first item from each array)
const covers = await sanityClient.fetch(`
  *[_type == "categoryCovers"][0] {
    "concrete": concrete[0]->{ image, title },
    "outdoorKitchens": outdoorKitchens[0]->{ image, title },
    "coveredPatios": coveredPatios[0]->{ image, title },
    "fireFeatures": fireFeatures[0]->{ image, title },
    "landscaping": landscaping[0]->{ image, title },
    "ironWork": ironWork[0]->{ image, title }
  }
`);

// Service cards in strategic order (core business first, then high-ticket, then complementary)
const services = [
  {
    name: "CONCRETE WORK",
    description: "Driveways, patios, walkways & flatwork",
    href: "/gallery/concrete",
    image: covers?.concrete?.image,
    alt: covers?.concrete?.title || "Concrete work",
  },
  {
    name: "OUTDOOR KITCHENS",
    description: "Custom outdoor kitchen designs & installations",
    href: "/gallery/outdoor-kitchens",
    image: covers?.outdoorKitchens?.image,
    alt: covers?.outdoorKitchens?.title || "Outdoor kitchen",
  },
  {
    name: "COVERED PATIOS",
    description: "Elegant covered patio structures & finishes",
    href: "/gallery/covered-patios",
    image: covers?.coveredPatios?.image,
    alt: covers?.coveredPatios?.title || "Covered patio",
  },
  {
    name: "FIRE FEATURES",
    description: "Fire pits, fireplaces & fire tables",
    href: "/gallery/fire-features",
    image: covers?.fireFeatures?.image,
    alt: covers?.fireFeatures?.title || "Fire feature",
  },
  {
    name: "LANDSCAPING",
    description: "Turf, gardens & water features",
    href: "/gallery/landscaping",
    image: covers?.landscaping?.image,
    alt: covers?.landscaping?.title || "Landscaping",
  },
  {
    name: "IRON WORK",
    description: "Gates, railings & decorative metalwork",
    href: "/gallery/ironwork",
    image: covers?.ironWork?.image,
    alt: covers?.ironWork?.title || "Iron work",
  },
];
---

<!-- DARK Section - Luxury Showcase with BENTO GRID + SCROLL ANIMATIONS -->
<section class="services section-padding bg-black-pure overflow-hidden border-t border-bronze/10" id="services">
  <div class="container max-w-7xl mx-auto px-6 md:px-8">
    <!-- Section Heading - Scroll fade in -->
    <div class="text-center mb-12 md:mb-16 scroll-reveal opacity-0">
      <h2 class="section-heading text-white mb-6">
        OUR SERVICES
      </h2>
      <div class="bronze-divider mx-auto"></div>
    </div>

    <!-- SERVICE GRID - Clean & Equal Layout -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
      {services.map((service, index) => (
        <a
          href={service.href}
          class="scroll-reveal opacity-0 group relative overflow-hidden bg-linear-to-br from-charcoal to-black-pure border-2 border-charcoal-light hover:border-bronze transition-all duration-500 cursor-pointer block h-[320px]"
          style={`animation-delay: ${0.1 * (index + 1)}s`}
        >
          <div class="absolute inset-0">
            {service.image ? (
              <img
                src={urlFor(service.image).width(800).height(600).auto('format').url()}
                alt={service.alt}
                class="w-full h-full object-cover transition-all duration-700 group-hover:scale-110"
                width="800"
                height="600"
                loading="lazy"
              />
            ) : (
              <div class="w-full h-full bg-charcoal flex items-center justify-center">
                <span class="text-slate text-sm">No cover image set</span>
              </div>
            )}
            <div class="absolute inset-0 bg-linear-to-t from-black via-black/70 to-black/30 group-hover:from-black/90 group-hover:via-black/60 transition-all duration-500"></div>
          </div>
          <div class="relative z-10 p-8 h-full flex flex-col justify-end">
            <h3 class="text-white text-2xl md:text-3xl font-bold mb-3 tracking-wide uppercase transform translate-y-0 group-hover:-translate-y-2 transition-transform duration-300">
              {service.name}
            </h3>
            <p class="text-[#D1D1D1] text-sm leading-relaxed opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 transition-all duration-500">
              {service.description}
            </p>
          </div>
        </a>
      ))}
    </div>
  </div>
</section>

<!-- SCROLL ANIMATION SCRIPT -->
<script>
  import { initScrollAnimations, CONTENT_CONFIG, CARD_CONFIG } from '../utils/animations.js';

  // Section heading - standard content animation
  initScrollAnimations('.services .text-center.scroll-reveal', CONTENT_CONFIG);

  // Service cards - snappier animation with higher threshold
  initScrollAnimations('.services a.scroll-reveal', CARD_CONFIG);
</script>

<style>
  /* Import reusable animations */
  @import '../styles/animations.css';
</style>
