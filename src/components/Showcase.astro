---
import { Image } from 'astro:assets';
import showcase11 from '../../public/img/show-case/backyard-remodels/showcase11.jpeg';
import showcase4 from '../../public/img/show-case/backyard-remodels/showcase4.jpeg';
import showcase5 from '../../public/img/show-case/concrete/showcase5.jpeg';
import showcase9 from '../../public/img/show-case/concrete/showcase9.jpeg';
import showcase7 from '../../public/img/show-case/backyard-remodels/showcase7.jpeg';
import showcase8 from '../../public/img/show-case/backyard-remodels/showcase8.jpeg';
import showcase2 from '../../public/img/show-case/backyard-remodels/showcase2.jpeg';
import showcase6 from '../../public/img/show-case/backyard-remodels/showcase6.jpeg';
import showcase10 from '../../public/img/show-case/concrete/showcase10.JPEG';
---

<section class="section-showcase py-24 md:py-32" id="showcase">
  <div class="container max-w-7xl mx-auto px-6 md:px-8">
    <h2 class="heading-secondary text-[#313131] text-4xl md:text-5xl font-semibold text-center mb-12 md:mb-16">
      See What We've Built
    </h2>
  </div>

  <!-- Slider Wrapper -->
  <div class="slider-wrapper relative w-full max-w-5xl mx-auto">
    <!-- Slider Container -->
    <div class="slider relative w-full h-[500px] md:h-[600px] lg:h-[650px] overflow-hidden rounded-lg shadow-xl">
    <!-- Slides -->
    <Image
      src={showcase11}
      alt="Outdoor grill and kitchen"
      class="slide absolute w-full transition-transform duration-1000"
      quality={85}
      loading="eager"
    />
    <Image
      src={showcase4}
      alt="Pool remodel"
      class="slide absolute w-full transition-transform duration-1000"
      quality={85}
      loading="lazy"
    />
    <Image
      src={showcase5}
      alt="Concrete stairs"
      class="slide absolute w-full transition-transform duration-1000"
      quality={85}
      loading="lazy"
    />
    <Image
      src={showcase9}
      alt="Red stamped concrete"
      class="slide absolute w-full transition-transform duration-1000"
      quality={85}
      loading="lazy"
    />
    <Image
      src={showcase7}
      alt="Pool being remodeled"
      class="slide absolute w-full transition-transform duration-1000"
      quality={85}
      loading="lazy"
    />
    <Image
      src={showcase8}
      alt="Concrete fire pit and seating"
      class="slide absolute w-full transition-transform duration-1000"
      quality={85}
      loading="lazy"
    />
    <Image
      src={showcase2}
      alt="Concrete fire pit and seating"
      class="slide absolute w-full transition-transform duration-1000"
      quality={85}
      loading="lazy"
    />
    <Image
      src={showcase6}
      alt="Brick fire pit"
      class="slide absolute w-full transition-transform duration-1000"
      quality={85}
      loading="lazy"
    />
    <Image
      src={showcase10}
      alt="Stamped concrete"
      class="slide absolute w-full transition-transform duration-1000"
      quality={85}
      loading="lazy"
    />

    <!-- Left Arrow Button -->
    <button
      class="slider__btn slider__btn--left absolute top-1/2 left-[6%] -translate-x-1/2 -translate-y-1/2 bg-white/70 border-none h-12 w-12 sm:h-[3.75rem] sm:w-[3.75rem] md:h-[4.6rem] md:w-[4.6rem] rounded-full flex items-center justify-center shadow-2xl cursor-pointer text-xl transition-all hover:bg-white focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-primary/50 z-[100]"
      aria-label="Previous slide"
    >
      &larr;
    </button>

    <!-- Right Arrow Button -->
    <button
      class="slider__btn slider__btn--right absolute top-1/2 right-[6%] translate-x-1/2 -translate-y-1/2 bg-white/70 border-none h-12 w-12 sm:h-[3.75rem] sm:w-[3.75rem] md:h-[4.6rem] md:w-[4.6rem] rounded-full flex items-center justify-center shadow-2xl cursor-pointer text-xl transition-all hover:bg-white focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-primary/50 z-[100]"
      aria-label="Next slide"
    >
      &rarr;
    </button>

    <!-- Dots Container (will be populated by JavaScript) -->
    <div class="dots absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-3 z-[100]"></div>
    </div>
  </div>

  <!-- View Full Gallery Link -->
  <div class="container max-w-7xl mx-auto px-6 md:px-8">
    <div class="social-link text-center text-lg mt-16">
      <a
        href="/showcase"
        class="link inline-block text-primary no-underline border-b border-current pb-0.5 transition-all duration-300 hover:text-primary-dark hover:border-transparent focus-visible:outline-none focus-visible:text-primary-dark"
      >
        View Full Gallery &rarr;
      </a>
    </div>
  </div>
</section>

<style is:global>
  /* Slide styles - cropped effect like original */
  .slide {
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 1;
  }

  /* Dot styles - must be global for dynamically created elements */
  .dots__dot {
    width: 14px !important;
    height: 14px !important;
    background: rgba(255, 255, 255, 0.5) !important;
    border: 2px solid white !important;
    border-radius: 50% !important;
    cursor: pointer !important;
    transition: all 0.3s !important;
    padding: 0 !important;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4) !important;
  }

  .dots__dot:hover {
    background: rgba(255, 255, 255, 0.8) !important;
    transform: scale(1.15);
  }

  .dots__dot--active {
    background: white !important;
    transform: scale(1.2);
    border-color: white !important;
  }
</style>

<script is:inline>
  // Slider functionality
  const slider = function () {
    const slides = document.querySelectorAll(".slide");
    const btnLeft = document.querySelector(".slider__btn--left");
    const btnRight = document.querySelector(".slider__btn--right");
    const dotContainer = document.querySelector(".dots");

    if (!slides.length || !btnLeft || !btnRight || !dotContainer) return;

    let curSlide = 0;
    const maxSlide = slides.length;

    // Functions
    const createDots = function () {
      slides.forEach(function (_, i) {
        dotContainer.insertAdjacentHTML(
          "beforeend",
          `<button class="dots__dot" data-slide="${i}" aria-label="Go to slide ${i + 1}"></button>`
        );
      });
    };

    const activateDot = function (slide) {
      document
        .querySelectorAll(".dots__dot")
        .forEach((dot) => dot.classList.remove("dots__dot--active"));

      const activeDot = document.querySelector(`.dots__dot[data-slide="${slide}"]`);
      if (activeDot) {
        activeDot.classList.add("dots__dot--active");
      }
    };

    const goToSlide = function (slide) {
      slides.forEach(
        (s, i) => (s.style.transform = `translateX(${100 * (i - slide)}%)`)
      );
    };

    // Next slide
    const nextSlide = function () {
      if (curSlide === maxSlide - 1) {
        curSlide = 0;
      } else {
        curSlide++;
      }

      goToSlide(curSlide);
      activateDot(curSlide);
    };

    const prevSlide = function () {
      if (curSlide === 0) {
        curSlide = maxSlide - 1;
      } else {
        curSlide--;
      }
      goToSlide(curSlide);
      activateDot(curSlide);
    };

    const init = function () {
      goToSlide(0);
      createDots();
      activateDot(0);
    };
    init();

    // Event handlers
    btnRight.addEventListener("click", nextSlide);
    btnLeft.addEventListener("click", prevSlide);

    document.addEventListener("keydown", function (e) {
      if (e.key === "ArrowLeft") prevSlide();
      e.key === "ArrowRight" && nextSlide();
    });

    dotContainer.addEventListener("click", function (e) {
      if (e.target.classList.contains("dots__dot")) {
        const { slide } = e.target.dataset;
        goToSlide(slide);
        activateDot(slide);
      }
    });
  };
  slider();
</script>
